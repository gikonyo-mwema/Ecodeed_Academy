# =============================================================================
# Frontend React CI Pipeline
# =============================================================================
# This workflow runs linting, builds, and tests for the React frontend.
# It includes:
#   - ESLint linting checks
#   - Production build verification
#   - Optional: Component testing (when tests are added)
# =============================================================================

name: Frontend React CI

# -----------------------------------------------------------------------------
# Trigger Configuration
# -----------------------------------------------------------------------------
# - Runs on push to 'develop' branch and any 'features/**' branches
# - Runs on pull requests targeting 'develop' or 'master' branches
# - Only triggers when frontend files change
# -----------------------------------------------------------------------------
on:
  push:
    branches:
      - develop
      - features/**
    paths:
      - 'frontend/**'
      - '.github/workflows/frontend-ci.yml'
  pull_request:
    branches:
      - develop
      - master
    paths:
      - 'frontend/**'
      - '.github/workflows/frontend-ci.yml'

# -----------------------------------------------------------------------------
# Global Environment Variables
# -----------------------------------------------------------------------------
env:
  NODE_VERSION: '20'

jobs:
  # ===========================================================================
  # LINT JOB
  # ===========================================================================
  # Runs ESLint to check for code quality issues in React components
  # ===========================================================================
  lint:
    name: Lint Code (ESLint)
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository code
      - name: Checkout code
        uses: actions/checkout@v5

      # Set up Node.js environment
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      # Install dependencies
      - name: Install dependencies
        working-directory: frontend
        run: npm ci

      # Run ESLint
      - name: Run ESLint
        working-directory: frontend
        run: npm run lint

  # ===========================================================================
  # BUILD JOB
  # ===========================================================================
  # Builds the production bundle to verify the app compiles correctly
  # ===========================================================================
  build:
    name: Build Production Bundle
    runs-on: ubuntu-latest
    needs: lint

    steps:
      # Checkout the repository code
      - name: Checkout code
        uses: actions/checkout@v5

      # Set up Node.js environment
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      # Install dependencies
      - name: Install dependencies
        working-directory: frontend
        run: npm ci

      # Build production bundle
      - name: Build production bundle
        working-directory: frontend
        run: npm run build

      # Upload build artifacts for deployment
      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: frontend-build
          path: frontend/dist/
          retention-days: 7

      # Output build summary
      - name: Build summary
        working-directory: frontend
        run: |
          echo "## ðŸ“¦ Frontend Build Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Build Status:** âœ… Success" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Build Size:**" >> $GITHUB_STEP_SUMMARY
          du -sh dist/ >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Files:**" >> $GITHUB_STEP_SUMMARY
          find dist -type f | wc -l | xargs -I {} echo "{} files" >> $GITHUB_STEP_SUMMARY
